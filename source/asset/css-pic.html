<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSS Image Playground</title>
    <style>
      html,
      body {
        padding: 0;
        margin: 0;
        font-size: 12px;
      }
      #container {
        width: 90vw;
        margin: 0 auto;
        display: flex;
        background-color: #eee;
        flex-direction: column;
      }
      #upload {
        border: 1px solid #000;
      }
      #pixel {
        width: 1px;
        height: 1px;
        background-color: transparent;
        overflow: hidden;
      }
      pre:before {
        content: '';
        display: block;
        background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);
        height: 30px;
        width: 100%;
        background-size: 40px;
        background-repeat: no-repeat;
        background-color: #f8f8f8;
        margin-bottom: -7px;
        border-radius: 5px;
        background-position: 10px 10px;
      }
      pre {
        max-width: 98%;
        border-radius: 4px;
        margin: 10px auto 0 auto;
        overflow: auto;
        background: #f8f8f8;
        border: 1px solid #ededed;
      }
      pre code {
        display: block;
        overflow-x: auto;
        padding: 0 16px;
        color: #333;
        background: #f8f8f8;
        display: -webkit-box;
        font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;
        border-radius: 0px;
        font-size: 12px;
        -webkit-overflow-scrolling: touch;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <h2>
        ä¸Šä¼ å›¾ç‰‡:ï¼ˆé€‚ç”¨åœºæ™¯æ˜¯å°iconã€logoç­‰ï¼Œå»ºè®®300*300åƒç´ ä»¥å†…ï¼Œä¸Šä¼ å¤§å›¾å¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨å¡é¡¿ï¼Œåæœè‡ªè´Ÿ~ï¼‰
      </h2>
      <div>
        <input id="fileIn" type="file" />
      </div>
      <h2>canvasé¢„è§ˆ:</h2>
      <canvas id="upload" width="300" height="200" style="width: 300px">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒcanvasï¼Œå¿«æ›´æ–°æµè§ˆå™¨å§ğŸ¤”
      </canvas>
      <h2>csså®ç°æ•ˆæœï¼š</h2>
      <div id="output">
        <div id="pixel"></div>
      </div>
      <h2>
        CSSä»£ç :
        <button id="copy">copy code</button>
        <span id="info"></span>
      </h2>
      <div id="source">
        <pre>
        <code id="code">

        </code>
      </pre>
      </div>
    </div>
    <script type="text/javascript">
      const P = Math.PI
      let code = ''
      document.addEventListener('DOMContentLoaded', init)

      function init() {
        document.addEventListener('change', function (e) {
          var imgFile = document.getElementById('fileIn').files[0]
          var imgEl = new Image()
          var canvas = document.getElementById('upload')
          if (!canvas.getContext) {
            document.body.innerHTML = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒcanvasï¼Œå¿«æ›´æ–°æµè§ˆå™¨å§ğŸ¤”'
            return
          }
          var ctx = canvas.getContext('2d')

          // fileè½¬image element
          imgEl.src = URL.createObjectURL(imgFile)
          imgEl.addEventListener('load', function () {
            var w = imgEl.width
            var h = imgEl.height
            // canvasæ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
            ctx.drawImage(imgEl, 0, 0, w, h, 0, 0, w, h)

            // canvas è·å– imageData rgbaæ•°æ®
            var _str = ''
            var pixelEl = document.getElementById('pixel')
            var imageDataArr = ctx.getImageData(0, 0, w, h).data
            let arr = []
            for (var y = 0; y < h; y++) {
              for (var x = 0; x < w; x++) {
                arr.push({
                  x: x,
                  y: y,
                  r: imageDataArr[(y * w + x) * 4],
                  g: imageDataArr[(y * w + x) * 4 + 1],
                  b: imageDataArr[(y * w + x) * 4 + 2],
                  a: imageDataArr[(y * w + x) * 4 + 3] / 255,
                })
              }
            }

            _str = arr
              .map((item) => {
                return `rgba(${item.r}, ${item.g}, ${item.b}, ${item.a}) ${item.x}px ${item.y}px`
              })
              .join(',')

            let _code =
              'width:1px;\n' +
              'height:1px;\n' +
              'background-color:transparent;\n' +
              'overflow:hidden;\n' +
              'box-shadow:' +
              arr
                .map((item) => {
                  return `\trgba(${item.r}, ${item.g}, ${item.b}, ${item.a}) ${item.x}px ${item.y}px`
                })
                .join(',\n')
            code = _code.replace(/\ +/g, '')
            document.getElementById('code').innerHTML = _code
            document.getElementById('output').style.height = h + 20 + 'px'

            pixelEl.style.boxShadow = _str
          })
        })

        document.querySelector('#copy').addEventListener('click', function () {
          const info = document.getElementById('info')
          navigator.clipboard.writeText(code).then(function() {
            info.textContent = 'success'
            info.style.color = 'green'
            setTimeout(function(){
              info.textContent = ''
              info.style.color = '#000'
            },3000)
          }, function() {
            info.textContent = 'fail'
            info.style.color = 'red'
            setTimeout(function(){
              info.textContent = ''
              info.style.color = '#000'
            },3000)
          });
        })

        // canvasç»ƒä¹ 
        // ç¬‘è„¸
        /* ctx.beginPath()
    ctx.arc(50,50,50,0,2*P,false)
    ctx.stroke()
    ctx.moveTo(75,50)  //ç§»åŠ¨å½“å‰canvasç¬”è§¦ä½ç½®
    ctx.arc(50,50,25,0,P,false)
    ctx.stroke()
    ctx.moveTo(65,40)
    ctx.arc(60,40,5,0,2*P,false)
    ctx.stroke()
    ctx.moveTo(45,40)
    ctx.arc(40,40,5,0,2*P,false)
    ctx.stroke() */

        // å¡«å……ä¸‰è§’å½¢
        /* ctx.beginPath()
    ctx.moveTo(10,10)
    ctx.lineTo(60,10)
    ctx.lineTo(10,60)
    ctx.fill() */
        //è·¯å¾„ä½¿ç”¨å¡«å……ï¼ˆfillï¼‰æ—¶ï¼Œè·¯å¾„è‡ªåŠ¨é—­åˆ

        // ä¸‰è§’å½¢
        /* ctx.beginPath()
    ctx.moveTo(70,20)
    ctx.lineTo(70,70)
    ctx.lineTo(20,70)
    ctx.closePath()
    ctx.stroke() */
        // ä½¿ç”¨æè¾¹ï¼ˆstrokeï¼‰åˆ™ä¸ä¼šé—­åˆè·¯å¾„ã€‚
        // å¦‚æœæ²¡æœ‰æ·»åŠ é—­åˆè·¯å¾„closePath()åˆ°æè¿°ä¸‰è§’å½¢å‡½æ•°ä¸­
        // åˆ™åªç»˜åˆ¶äº†ä¸¤æ¡çº¿æ®µï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸‰è§’å½¢

        // å¡«å……ä¸Šå¼¦æœˆ
        /* ctx.beginPath();
    ctx.arc(50,50,50,0,1.5*P,false)
    ctx.fill(); */

        // è´å¡å°”æ›²çº¿
        // quadraticCurveTo(cp1x, cp1y, x, y)
        // ç»˜åˆ¶äºŒæ¬¡è´å¡å°”æ›²çº¿ï¼Œcp1x,cp1yä¸ºä¸€ä¸ªæ§åˆ¶ç‚¹ï¼Œx,yä¸ºç»“æŸç‚¹ï¼ˆèµ·å§‹ç‚¹ä¸ºå½“å‰canvasç¬”è§¦ä½ç½®ï¼‰
        // äºŒæ¬¡è´å¡å°”æ›²çº¿ å¯¹è¯æ¡†
        /* ctx.beginPath();
    ctx.moveTo(75, 25);
    ctx.quadraticCurveTo(25, 25, 25, 62.5);
    ctx.quadraticCurveTo(25, 100, 50, 100);
    ctx.quadraticCurveTo(50, 120, 30, 125);
    ctx.quadraticCurveTo(60, 120, 65, 100);
    ctx.quadraticCurveTo(125, 100, 125, 62.5);
    ctx.quadraticCurveTo(125, 25, 75, 25);
    ctx.stroke(); */

        // bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)
        // ç»˜åˆ¶ä¸‰æ¬¡è´å¡å°”æ›²çº¿ï¼Œcp1x,cp1yä¸ºæ§åˆ¶ç‚¹ä¸€ï¼Œcp2x,cp2yä¸ºæ§åˆ¶ç‚¹äºŒï¼Œx,yä¸ºç»“æŸç‚¹ï¼ˆèµ·å§‹ç‚¹ä¸ºå½“å‰canvasç¬”è§¦ä½ç½®ï¼‰
        // ä¸‰æ¬¡è´å¡å°”æ›²çº¿ çˆ±å¿ƒ
        /* ctx.beginPath();
    ctx.moveTo(75, 40);
    ctx.bezierCurveTo(75, 37, 70, 25, 50, 25);
    ctx.bezierCurveTo(20, 25, 20, 62.5, 20, 62.5);
    ctx.bezierCurveTo(20, 80, 40, 102, 75, 120);
    ctx.bezierCurveTo(110, 102, 130, 80, 130, 62.5);
    ctx.bezierCurveTo(130, 62.5, 130, 25, 100, 25);
    ctx.bezierCurveTo(85, 25, 75, 37, 75, 40);
    ctx.fill(); */

        // å°è£…çš„ä¸€ä¸ªç”¨äºç»˜åˆ¶åœ†è§’çŸ©å½¢çš„å‡½æ•°.
        function roundedRect(ctx, x, y, width, height, radius) {
          ctx.beginPath()
          ctx.moveTo(x, y + radius)
          ctx.lineTo(x, y + height - radius)
          ctx.quadraticCurveTo(x, y + height, x + radius, y + height)
          ctx.lineTo(x + width - radius, y + height)
          ctx.quadraticCurveTo(
            x + width,
            y + height,
            x + width,
            y + height - radius
          )
          ctx.lineTo(x + width, y + radius)
          ctx.quadraticCurveTo(x + width, y, x + width - radius, y)
          ctx.lineTo(x + radius, y)
          ctx.quadraticCurveTo(x, y, x, y + radius)
          ctx.stroke()
        }

        // ç»„åˆå›¾
        /* roundedRect(ctx, 12, 12, 150, 150, 15);
    roundedRect(ctx, 19, 19, 150, 150, 9);
    roundedRect(ctx, 53, 53, 49, 33, 10);
    roundedRect(ctx, 53, 119, 49, 16, 6);
    roundedRect(ctx, 135, 53, 49, 33, 10);
    roundedRect(ctx, 135, 119, 25, 49, 10);

    ctx.beginPath();
    ctx.arc(37, 37, 13, Math.PI / 7, -Math.PI / 7, false);
    ctx.lineTo(31, 37);
    ctx.fill();

    for(var i = 0; i < 8; i++){
      ctx.fillRect(51 + i * 16, 35, 4, 4);
    }

    for(i = 0; i < 6; i++){
      ctx.fillRect(115, 51 + i * 16, 4, 4);
    }

    for(i = 0; i < 8; i++){
      ctx.fillRect(51 + i * 16, 99, 4, 4);
    }

    ctx.beginPath();
    ctx.moveTo(83, 116);
    ctx.lineTo(83, 102);
    ctx.bezierCurveTo(83, 94, 89, 88, 97, 88);
    ctx.bezierCurveTo(105, 88, 111, 94, 111, 102);
    ctx.lineTo(111, 116);
    ctx.lineTo(106.333, 111.333);
    ctx.lineTo(101.666, 116);
    ctx.lineTo(97, 111.333);
    ctx.lineTo(92.333, 116);
    ctx.lineTo(87.666, 111.333);
    ctx.lineTo(83, 116);
    ctx.fill();

    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.moveTo(91, 96);
    ctx.bezierCurveTo(88, 96, 87, 99, 87, 101);
    ctx.bezierCurveTo(87, 103, 88, 106, 91, 106);
    ctx.bezierCurveTo(94, 106, 95, 103, 95, 101);
    ctx.bezierCurveTo(95, 99, 94, 96, 91, 96);
    ctx.moveTo(103, 96);
    ctx.bezierCurveTo(100, 96, 99, 99, 99, 101);
    ctx.bezierCurveTo(99, 103, 100, 106, 103, 106);
    ctx.bezierCurveTo(106, 106, 107, 103, 107, 101);
    ctx.bezierCurveTo(107, 99, 106, 96, 103, 96);
    ctx.fill();

    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(101, 102, 2, 0, Math.PI * 2, true);
    ctx.fill();

    ctx.beginPath();
    ctx.arc(89, 102, 2, 0, Math.PI * 2, true);
    ctx.fill(); */

        // Path2Då¯¹è±¡ï¼šç¼“å­˜ã€é‡ç”¨ç»˜ç”»å‘½ä»¤/svg(canvas contextä¸Šçš„ä¸€åˆ‡å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨)
        /* var rectangle = new Path2D();
    rectangle.rect(10, 10, 50, 50);
    var circle = new Path2D();
    circle.moveTo(125, 35);
    circle.arc(100, 35, 25, 0, 2 * Math.PI);
    ctx.stroke(rectangle);
    ctx.fill(circle); */

        // æ ·å¼
        // ctx.fillStyle = "rgba(255,165,0,1)";
        // ctx.strokeStyle  = "rgba(255,165,0,1)";
        // ctx.globalAlpha = 0.2;
        // ctx.fillRect(0,37.5,150,37.5);
        // ctx.lineWidth = 2;
        //https://developer.mozilla.org/@api/deki/files/601/=Canvas-grid.png
      }
    </script>
  </body>
</html>
